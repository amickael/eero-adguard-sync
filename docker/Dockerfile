FROM python:3.10
ENV PYTHONUNBUFFERED=1

ARG EAG_VERSION
ARG EERO_COOKIE
ARG ADGUARD_HOST
ARG ADGUARD_USER
ARG ADGUARD_PASS
ARG SYNC_FLAGS

ENV EAG_EERO_COOKIE=$EERO_COOKIE
ENV EAG_ADGUARD_HOST=$ADGUARD_HOST
ENV EAG_ADGUARD_USER=$ADGUARD_USER
ENV EAG_ADGUARD_PASS=$ADGUARD_PASS
ENV EAG_SYNC_FLAGS=$SYNC_FLAGS

RUN apt-get update && apt-get -y install cron
RUN sleep 15
RUN pip install eero-adguard-sync==$EAG_VERSION

COPY ./sync.sh /etc/cron.hourly/

CMD ["cron", "-f"]
